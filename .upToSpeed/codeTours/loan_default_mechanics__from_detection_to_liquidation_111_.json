{"title":"Loan Default Mechanics: From Detection to Liquidation","id":"e8mBQgo/PDGOKpIm+C82zewJdOHAPBwaoYVl2m0zjLQ=","position":6,"steps":[{"type":"textOnly","description":"The **Cooler** project manages loan defaults through a combination of smart contracts. The `Cooler` contract handles individual loans, the `Clearinghouse` manages the overall lending facility, and the `CoolerFactory` logs important events. We'll examine how these components work together to handle loan defaults and collateral liquidation.","title":"","id":"545"},{"type":"highlight","description":"The **`Cooler`** contract is responsible for detecting when a loan has defaulted. This is primarily done in the **`claimDefaulted`** function. The function checks if the current timestamp is past the loan's expiry date (line 322). If so, it considers the loan defaulted and proceeds with the default handling process.","file":"Cooler/src/Cooler.sol","highlight":[{"start":318,"end":333}],"title":"","id":"546"},{"type":"highlight","description":"When a loan defaults, **the collateral** is transferred to **the lender**. This transfer (line 325) ensures that **the lender** receives **the collateral** as compensation for the defaulted loan.","file":"Cooler/src/Cooler.sol","highlight":[{"start":324,"end":325}],"title":"","id":"547"},{"type":"highlight","description":"The **`Cooler`** contract logs the **default event** through the **`CoolerFactory`**. This logging (line 328) ensures transparency and allows for tracking of defaulted loans across the system.","file":"Cooler/src/Cooler.sol","highlight":[{"start":327,"end":328}],"title":"","id":"548"},{"type":"highlight","description":"The **`Clearinghouse`** contract manages defaults across multiple loans. The **`claimDefaulted`** function (lines 191-213) processes multiple defaulted loans simultaneously. It takes two arrays as input: **`coolers_`** (addresses of Cooler contracts) and **`loans_`** (corresponding loan IDs). This function accumulates total debt, interest, and collateral from the defaulted loans.","file":"Cooler/src/Clearinghouse.sol","highlight":[{"start":191,"end":213}],"title":"","id":"565"},{"type":"highlight","description":"The function begins with input validation. It checks if the lengths of the `coolers_` and `loans_` arrays match (line 193). This ensures that each **Cooler** address has a corresponding loan ID. If the lengths don't match, the function reverts with a **`LengthDiscrepancy`** error.","file":"Cooler/src/Clearinghouse.sol","highlight":[{"start":192,"end":193}],"title":"","id":"566"},{"type":"highlight","description":"The function uses a `for` loop (lines 199-213) to iterate through all the loans. Before processing each loan, it validates that the **Cooler contract** was deployed by the trusted factory (line 201). This check prevents processing loans from unauthorized **Cooler contracts**.","file":"Cooler/src/Clearinghouse.sol","highlight":[{"start":199,"end":201}],"title":"","id":"567"},{"type":"highlight","description":"For each loan, the function calls `claimDefaulted` on the respective `Cooler` contract (line 204). This call returns the debt, collateral, and elapsed time since default. The function then calculates the interest from the debt (line 205). The total debt, interest, and collateral are accumulated in variables (lines 208-210) to keep track of the overall impact of the defaulted loans.","file":"Cooler/src/Clearinghouse.sol","highlight":[{"start":204,"end":210}],"title":"","id":"568"},{"type":"highlight","description":"**The Clearinghouse** incentivizes keepers to claim defaulted loans by offering rewards. This reward system (lines 215-224) encourages timely claiming of defaulted loans, capping rewards to prevent excessive dilution.","file":"Cooler/src/Clearinghouse.sol","highlight":[{"start":215,"end":224}],"title":"","id":"550"},{"type":"highlight","description":"After processing defaults, the **Clearinghouse** updates its receivables. This adjustment (lines 228-238) ensures that the **Clearinghouse**'s financial state accurately reflects the defaulted loans, updating both receivables and outstanding debt to the **Treasury**.","file":"Cooler/src/Clearinghouse.sol","highlight":[{"start":228,"end":238}],"title":"","id":"551"},{"type":"textOnly","description":"The **Cooler** project's approach to loan default handling and collateral liquidation involves multiple components working together. The `Cooler` contract detects individual loan defaults and transfers collateral, the `CoolerFactory` logs these events, and the `Clearinghouse` manages the overall process, including keeper incentives and financial state updates. This system handles defaults while maintaining transparency and financial accuracy.","title":"","id":"552"}]}